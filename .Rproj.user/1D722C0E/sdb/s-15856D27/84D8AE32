{
    "contents" : "#!/usr/local/env Rscript\n\narchivePath <- \"/imppc/labs/maplab/share/imallona2fchen/NA_analysis_data/\"\noutputPath <- \"/home/labs/maplab/fchen/na_folder/\"\n\ngetLinks <- function (URL, REGEXPR){\n  if(exists(\"getURL\") == FALSE){\n    require (RCurl)\n  }\n  if (url.exists(URL)){\n    scrapedData <- getURL(URL)\n    links <- strsplit(scrapedData, \"href=\\\"\")[[1]]\n    linkIndices <- grep(REGEXPR, links)\n    if (length(linkIndices > 0)){\n      list <- vector (\"list\", length(linkIndices))\n      for (i in 1:length(linkIndices)){\n        list[[i]][[1]] <- regmatches(links[linkIndices[i]], regexpr(REGEXPR, links[linkIndices[i]]))\n        list[[i]][[2]] <- regmatches(links[linkIndices[i]], regexpr(\"[[:alnum:]]{4}-[[:alnum:]]{2}-[[:alnum:]]{2}[[:blank:]][[:alnum:]]{2}[[:punct:]][[:alnum:]]{2}\", links[linkIndices[i]]))\n      }\n      return (list)\n    }\n  }\n}\n\ninit <- function (cancer, array){\n  accessRoot <<- \"https://tcga-data.nci.nih.gov/tcgafiles/ftp_auth/distro_ftpusers/anonymous/tumor/\"\n  cancerName <<- cancer\n  arrayName <<- array\n  switch(array,\n         humanmethylation450 = {\n           arrayPath <<- \"/cgcc/jhu-usc.edu/humanmethylation450/methylation/\"\n           archiveRegexpr <<- \"jhu-usc.edu_[[:alpha:]]*.HumanMethylation450.Level_3.[0-9]+.6.[0-9]/\"\n           fileRegexpr <<-  \"jhu-usc.edu_[[:alpha:]]*.HumanMethylation450.[[:alnum:]]*.lvl-3.TCGA-[[:alnum:]]*-[[:alnum:]]*-0[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*.txt\"\n           barcodeRegexpr <<- \"TCGA-[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*\"\n           value <<- \"Beta_value\"\n           magetabArchiveRegexpr <<- \"jhu-usc.edu_[[:alpha:]]{2,4}.HumanMethylation450.mage-tab.[[:digit:]]+.[[:digit:]]+.0/\"\n           magetabFileRegexpr <<- \"jhu-usc.edu_[[:alpha:]]{2,4}.HumanMethylation450.[[:digit:]]+.[[:digit:]]+.0.sdrf.txt\"\n         },\n         agilentg4502a_07_3 = {\n           arrayPath <<- \"/cgcc/unc.edu/agilentg4502a_07_3/transcriptome/\"\n           magetabArchiveRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.AgilentG4502A_07_3.mage-tab.[[:digit:]]+.[[:digit:]]+.0/\"\n           magetabFileRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.AgilentG4502A_07_3.sdrf.txt\"\n         },\n         illuminaga_rnaseq = {\n           arrayPath <<- \"/cgcc/unc.edu/illuminaga_rnaseq/rnaseq/\"\n           magetabArchiveRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaGA_RNASeq.mage-tab.[[:digit:]]+.[[:digit:]]+.0/\"\n           magetabFileRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaGA_RNASeq.[[:digit:]]+.sdrf.txt\"\n         },\n         illuminaga_rnaseqv2 = {\n           arrayPath <<- \"/cgcc/unc.edu/illuminaga_rnaseqv2/rnaseqv2/\"\n           magetabArchiveRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaGA_RNASeqV2.mage-tab.[[:digit:]]+.[[:digit:]]+.0/\"\n           magetabFileRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaGA_RNASeqV2.[[:digit:]]+.[[:digit:]]+.0.sdrf.txt\"\n         },\n         illuminahiseq_rnaseq = {\n           arrayPath <<- \"/cgcc/unc.edu/illuminahiseq_rnaseq/rnaseq/\"\n           magetabArchiveRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaHiSeq_RNASeq.mage-tab.[[:digit:]]+.[[:digit:]]+.0/\"\n           magetabFileRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaHiSeq_RNASeq.[[:digit:]]+.sdrf.txt\"\n         },\n         illuminahiseq_rnaseqv2 = {\n           arrayPath <<- \"/cgcc/unc.edu/illuminahiseq_rnaseqv2/rnaseqv2/\"\n           archiveRegexpr <<- \"unc.edu_[[:alpha:]]*.IlluminaHiSeq_RNASeqV2.Level_3.[0-9]+.6.[0-9]/\"\n           fileRegexpr <<-  \"unc.edu.[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*-[[:alnum:]]*.[[:alnum:]]*.bt.exon_quantification.txt\"\n           barcodeRegexpr <<- \"[[:alnum:]]{8}-[[:alnum:]]{4}-[[:alnum:]]{4}-[[:alnum:]]{4}-[[:alnum:]]{12}\"\n           value <<- \"RPKM\"\n           magetabArchiveRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaHiSeq_RNASeqV2.mage-tab.[[:digit:]]+.[[:digit:]]+.0/\"\n           magetabFileRegexpr <<- \"unc.edu_[[:alpha:]]{2,4}.IlluminaHiSeq_RNASeqV2.[[:digit:]]+.[[:digit:]]+.0.sdrf.txt\"\n         })\n  \n}\n\nanalyzeNAs <- function (cancer, array){\n  init(cancer, array)\n  df <- read.table(paste(readPath, cancerName, \"_\", arrayName, \"_to_SQL.txt\", sep = \"\"), sep = \"\\t\", header = TRUE)\n  \n  probeTable <- as.data.frame (matrix(nrow = nrow(df), ncol = 3))\n  sampleTable <- as.data.frame (matrix(nrow = 2, ncol = ncol(df[,2:ncol(df)])))\n  \n  probeTable[,1] <- df[,1]\n  probeTable[,2] <- apply(df[,2:ncol(df)], 1, function(z) sum(is.na(z)))\n  probeTable[,3] <- apply(df[,2:ncol(df)], 1, function(z) sd(z, na.rm=TRUE))\n  \n  write.table(probeTable, paste(writePath, cancerName, \"_\", arrayName, \"_probe_NA_sd.txt\", sep = \"\"), append = FALSE, sep = \"\\t\", quote = FALSE)\n  archiveList <- getLinks(paste(accessRoot, cancerName, arrayPath, sep = \"\"), archiveRegexpr)\n  pairedBarcodes <- read.table(paste(readPath, cancerName, \"_commonPatients_\", array, \".txt\", sep = \"\"), sep = \"\\t\", header = TRUE)\n  l <<- 1\n  for (k in 1:length(archiveList)){\n    fileList <- getLinks(paste(accessRoot, cancerName, arrayPath, archiveList[[k]][[1]], sep = \"\"), fileRegexpr)\n    if (length(fileList) > 0){\n      for (j in 1: length(fileList)){\n        barcode <- regmatches(fileList[[j]][[1]], regexpr(barcodeRegexpr, fileList[[j]][[1]]))\n        if (barcode %in% pairedBarcodes$Comment..TCGA.Barcode.){\n          sampleTable[1,l] <- barcode\n          l <<- l+1\n        }\n      }\n    }\n  }\n  sampleTable[2,] <- apply(df[,2:ncol(df)], 2, function(z) sum(is.na(z)))\n  \n  write.table(sampleTable, paste(writePath, cancerName, \"_\", arrayName, \"_sample_NA.txt\", sep = \"\"), append = FALSE, sep = \"\\t\", quote = FALSE) \n}\n\ncancer <- \"coad\"\narray <- \"illuminahiseq_rnaseqv2\"\nreadPath <- \"/imppc/labs/maplab/share/imallona2fchen/NA_analysis_data/\"\nwritePath <- \"/home/labs/maplab/fchen/na_folder/\"\n\nanalyzeNAs(cancer, array)",
    "created" : 1394468934842.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "24|33|68|0|\n",
    "hash" : "3877543270",
    "id" : "84D8AE32",
    "lastKnownWriteTime" : 1394469176,
    "path" : "/imppc/labs/maplab/share/imallona2fchen/toCluster.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}